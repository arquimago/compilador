package Main;

import java.io.IOException;
import java.io.PushbackReader;
import Cmenos.lexer.Lexer;
import Cmenos.lexer.LexerException;
import Cmenos.node.*;


public class LexerTh extends Lexer {
	
	private int contador = 0;
	private TComentarioE comentario = null;
	private String texto;
	
	public LexerTh(final PushbackReader in) {
		super(in);
		
	}
	
	@Override
	protected void filter() throws LexerException, IOException {
		if(state.equals(State.COMENTARIO)){
			if(comentario == null){
				comentario = (TComentarioE) token;
				contador ++;
				token = null;
			} else {
				texto += token.getText();
				if(token instanceof TComentarioE) {
					contador++;
				} else if (token instanceof TComentarioD) {
					contador--;
				} else {
					InvalidToken invalido = new InvalidToken("Token Invalido", comentario.getLine(), comentario.getPos());
					throw new LexerException(invalido, "Token Invalido: " + texto + " linha: " + invalido.getLine() + " coluna: " + invalido.getPos()); 
				}
				if(contador!=0){
					token=null;
				} else {
					comentario.setText(texto.toString());
					token = comentario;
					state = State.NORMAL;
					comentario = null;
				}
			}
		}
    }
	

}
